<%=
  [ "Defendant Name",
    "Gender",
    "Age",
    "Borough",
    "Docket #",
    "Top Charge Severity",
    "Top Charge",
    "Top Charge Description",
    "Number of Prior Criminal Convictions",
    "Number of Other Open Cases",
    "Has Failed to Appear on a Previous Case?",
    "Has an Oustanding Bench Warrant",
    "Perisistent Misdemeanant",
    "On Probation",
    "On Parole",
    "CJA Release Recommendation",
    "Arraignment Outcome",
    "Next Court Date",
    "Next Court Part"
  ].join(",") %>
<% @incidents.each do |incident| %>
<%= CSV.generate_line([ 
  incident.defendant_name,
  incident.defendant_sex,
  incident.defendant_age,
  incident.borough,
  incident.docket_number,
  incident.top_charge_code,
  incident.top_charge["agency_code"],
  incident.top_charge["description"],
  incident.number_of_prior_criminal_convictions,
  incident.number_of_other_open_cases,
  incident.has_failed_to_appear ? "Yes" : "No",
  incident.has_outstanding_bench_warrant? ? "Yes" : "No",
  incident.persistent_misdemeanant? ? "Yes" : "No",
  incident.on_probation? ? "Yes" : "No",
  incident.on_parole? ? "Yes" : "No",
  incident.ror_report.try { |r| r.recommendations.map { |x| x.capitalize }.join(", ") },
  incident.arraignment_outcome,
  incident.next_court_date,
  incident.next_court_part,
], {:col_sep => ",", :row_sep => "\r\n"}).chomp %>
<% end %>
